<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>新浪博客批量备份工具</title>
<style>
  body {
    background-color: #fefefe;
    margin: 0;
  }
  .title {
    box-shadow: 0 0 16px -9px #44444469;
    line-height: 45px;
  }
  .inner {
    color: darkseagreen;
    margin-left: auto;
    margin-right: auto;
    width: 480px;
    font-size: 24px;
  }
  #app {
    padding: 25px 0;
    margin-left: auto;
    margin-right: auto;
    width: 480px;
  }
  label {
    color: darkseagreen;
    line-height: 36px;
    display: block;
  }
  .userid {
    margin-bottom: 25px;
  }
  input[name=uid] {
    height: 30px;
    width: 100%;
    line-height: 30px;
    border: 1px dashed #e2e2e2;
    border-radius: 3px;
    padding: 5px;
    box-sizing: border-box;
  }
  input[name=uid]:focus {
    outline: 1px dashed darkseagreen;
  }
  .cookie {
    margin-bottom: 25px;
  }
  textarea[name=cookie] {
    height: 120px;
    width: 100%;
    border-radius: 3px;
    border: 1px dashed #e2e2e2;
    padding: 5px;
    box-sizing: border-box;
  }
  textarea[name=cookie]:focus {
    outline: 1px dashed darkseagreen;
  }
  .button {
    margin-bottom: 25px;
  }
  .button a {
    cursor: pointer;
  }
  .btn {
    display: inline-block;
    width: 100px;
    color: #fff;
    background-color: darkseagreen;
    line-height: 36px;
    text-align: center;
    border-radius: 3px;
  }
  .help {
    font-size: 13px;
    padding-left: 10px;
    margin-bottom: 20px;
  }
  .output {
    font-size: 12px;
    height: 270px;
    padding: 8px;
    border-radius: 3px;
    overflow-y: auto;
    color: #fff;
  }
  .loging {
    background-color: #000;
  }
  a {
    color: darkseagreen;
    text-decoration: none;
  }
  .error {
    color: red;
    height: 26px;
    text-decoration: none;
  }
</style>
</head>
<body>
  <div class="title">
    <div class="inner">新浪博客批量备份工具</div>
  </div>
  <div id="app">
    <div class="error" id="err"></div>
    <div class="userid"><label for="uid">UID:</label> <input name="uid" id="uid" /></div> 
    <div class="cookie"><label for="cookie">Cookie:</label><textarea name="cookie" id="cookie"></textarea></div> 
    <div class="button">
      <a class="btn" id="btn">确定</a>
      <a class="help" id="help" href="https://gitee.com/junyiz/dature#%E5%A6%82%E4%BD%95%E6%9F%A5%E7%9C%8B%E6%96%B0%E6%B5%AA%E5%8D%9A%E5%AE%A2%E7%9A%84-uid">点击查看如何获取 UID 和 Cookie？</a>
    </div> 
    <div class="output" id="out"></div>
  </div>
  <script>
    const btn = document.getElementById('btn')
    const err = document.getElementById('err')
    const out = document.getElementById('out')
    btn.addEventListener('click', () => {
      const uid = document.getElementById('uid').value
      const cookie = document.getElementById('cookie').value
      if (!uid || !cookie) {
        console.log(uid, cookie)
        err.innerHTML = '请输入 UID 和 Cookie'
        return
      }
      const source = new EventSource(`/api/sina?u=${uid}&c=${encodeURIComponent(cookie)}`)
      out.classList.add('loging')
      source.onmessage = function(event) {
        if (event.data === 'SSEEND') {
		out.innerHTML = out.innerHTML + '<br />' + `备份完成<br />预览 <a href="https://immich.cn/blog/${uid}/" target=_blank"">https://immich.cn/blog/${uid}/</a><br />下载 <a href="https://immich.cn/blog/${uid}.zip" target=_blank"">https://immich.cn/blog/${uid}.zip</a>` + '<br />'
          source.close()
        } else {
          out.innerHTML = out.innerHTML + event.data + '<br />'
        }
      }
    })
    const observer = new MutationObserver(() => {
      out.scrollTop = out.scrollHeight
    })
    observer.observe(out, { childList: true, subtree: true })
  </script>
</body>
</html>
